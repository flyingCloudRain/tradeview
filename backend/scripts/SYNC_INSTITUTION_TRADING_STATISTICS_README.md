# 机构交易统计数据同步脚本

## 脚本说明

`sync_institution_trading_statistics_30days.py` 是一个临时脚本，用于批量获取近期N个交易日的机构交易统计数据。

## 功能特点

- ✅ 自动获取交易日历（使用 akshare 接口）
- ✅ 智能跳过已有数据的日期
- ✅ 显示详细的同步进度和结果
- ✅ 支持强制同步模式
- ✅ 支持自定义交易日数量

## 使用方法

### 基本用法

```bash
# 同步最近30个交易日的数据（默认）
cd backend
python3 scripts/sync_institution_trading_statistics_30days.py

# 同步最近N个交易日的数据
python3 scripts/sync_institution_trading_statistics_30days.py --days 60

# 自动确认，跳过交互式确认（适合脚本调用）
python3 scripts/sync_institution_trading_statistics_30days.py --days 30 --yes

# 强制同步，即使已有数据也重新同步
python3 scripts/sync_institution_trading_statistics_30days.py --days 30 --force --yes
```

### 参数说明

- `--days N`: 需要获取的交易日数量（默认：30）
- `--force`: 强制同步，即使已有数据也重新同步
- `--yes` / `-y`: 自动确认，跳过交互式确认

## 输出示例

```
============================================================
获取交易日历...
============================================================
[获取交易日历] 日期范围: 20251117 - 20260116
[获取交易日历] 找到 30 个交易日

将同步以下 30 个交易日的数据：
  1. 2026-01-16
  2. 2026-01-15
  ... 还有 28 个交易日

============================================================
开始同步 30 个交易日的机构交易统计数据
============================================================

[1/30] 同步 2026-01-16 的数据...
  ⏭️  跳过（已有 46 条数据）
[2/30] 同步 2026-01-15 的数据...
  ✅ 成功: 成功同步 56 条机构交易统计数据
...

============================================================
同步完成！
============================================================
总计: 30 个交易日
成功: 25 个
失败: 2 个
跳过: 3 个
============================================================
```

## 注意事项

1. **数据来源**: 数据来自 akshare 的 `stock_lhb_jgmmtj_em` 接口
2. **数据去重**: 脚本会自动合并同一股票在同一天的多条记录（不同上榜原因）
3. **跳过已有数据**: 默认会跳过已有数据的日期，使用 `--force` 可强制重新同步
4. **交易日历**: 脚本会尝试从 akshare 获取交易日历，失败时会使用简化方法（排除周末）

## 错误处理

- 如果某个日期同步失败，脚本会继续处理下一个日期
- 所有失败信息会在最后汇总显示
- 可以使用 `--force` 选项重新同步失败的日期
