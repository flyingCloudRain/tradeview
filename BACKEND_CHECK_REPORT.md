# åŽç«¯åº”ç”¨æ£€æŸ¥æŠ¥å‘Š

## ðŸ“‹ æ£€æŸ¥æ—¶é—´
2026-01-11

## âœ… æ£€æŸ¥é¡¹ç›®

### 1. ä»£ç ç»“æž„ âœ…
- âœ… äº‘å‡½æ•°å…¥å£æ–‡ä»¶ (`index.py`) å­˜åœ¨
- âœ… FastAPI åº”ç”¨ (`app/main.py`) å­˜åœ¨
- âœ… API è·¯ç”±ç»“æž„å®Œæ•´
- âœ… æ•°æ®åº“é…ç½®æ­£ç¡®
- âœ… CORS é…ç½®å·²æ›´æ–°

### 2. å…³é”®æ–‡ä»¶æ£€æŸ¥

#### 2.1 äº‘å‡½æ•°å…¥å£ (`functions/trading-api/index.py`)
- âœ… è·¯å¾„å‰ç¼€å¤„ç†ï¼ˆåŽ»æŽ‰ `/trading-api`ï¼‰
- âœ… CORS å¤´ç¡®ä¿é€»è¾‘
- âœ… è°ƒè¯•æ—¥å¿—
- âš ï¸ **éœ€è¦æ£€æŸ¥**: `migrate.py` æ–‡ä»¶æ˜¯å¦å­˜åœ¨

#### 2.2 FastAPI åº”ç”¨ (`functions/trading-api/app/main.py`)
- âœ… CORS ä¸­é—´ä»¶é…ç½®
- âœ… å¼‚å¸¸å¤„ç†å™¨ï¼ˆåŒ…å« CORS å¤´ï¼‰
- âœ… OPTIONS è¯·æ±‚å¤„ç†
- âœ… è·¯ç”±æ³¨å†Œæ­£ç¡®

#### 2.3 é…ç½®æ–‡ä»¶ (`functions/trading-api/app/config.py`)
- âœ… æ•°æ®åº“é…ç½®
- âœ… CORS é…ç½®ï¼ˆåŒ…å« CloudBase åŸŸåï¼‰
- âœ… çŽ¯å¢ƒå˜é‡æ”¯æŒ

### 3. API ç«¯ç‚¹åˆ—è¡¨

åŽç«¯åº”ç”¨æä¾›ä»¥ä¸‹ API ç«¯ç‚¹ï¼š

#### 3.1 å¤§ç›˜æŒ‡æ•° (`/api/v1/index/`)
- `GET /` - èŽ·å–æŒ‡æ•°åˆ—è¡¨
- `GET /{index_code}/history` - èŽ·å–æŒ‡æ•°åŽ†å²æ•°æ®

#### 3.2 æ¦‚å¿µæ¿å— (`/api/v1/sector/`)
- `GET /` - èŽ·å–æ¿å—åˆ—è¡¨
- `GET /{sector_code}` - èŽ·å–æ¿å—è¯¦æƒ…

#### 3.3 é¾™è™Žæ¦œ (`/api/v1/lhb/`)
- `GET /` - èŽ·å–é¾™è™Žæ¦œåˆ—è¡¨
- `GET /{stock_code}` - èŽ·å–é¾™è™Žæ¦œè¯¦æƒ…
- `GET /institution` - èŽ·å–æœºæž„æ¦œ
- `GET /traders` - èŽ·å–äº¤æ˜“å‘˜åˆ—è¡¨

#### 3.4 æ¶¨åœæ±  (`/api/v1/zt-pool/`)
- `GET /` - èŽ·å–æ¶¨åœæ± åˆ—è¡¨
- `GET /analysis` - èŽ·å–æ¶¨åœåˆ†æž
- `GET /concepts` - èŽ·å–æ¦‚å¿µåˆ—è¡¨
- `POST /sync` - åŒæ­¥æ¶¨åœæ± æ•°æ®

#### 3.5 è·Œåœæ±  (`/api/v1/zt-pool-down/`)
- `GET /` - èŽ·å–è·Œåœæ± åˆ—è¡¨

#### 3.6 èµ„é‡‘æµ (`/api/v1/stock-fund-flow/`)
- `GET /` - èŽ·å–èµ„é‡‘æµåˆ—è¡¨
- `GET /{stock_code}/history` - èŽ·å–èµ„é‡‘æµåŽ†å²
- `GET /concept` - èŽ·å–æ¦‚å¿µèµ„é‡‘æµ
- `GET /industry` - èŽ·å–è¡Œä¸šèµ„é‡‘æµ

#### 3.7 æ´»è·ƒæœºæž„ (`/api/v1/capital/`)
- `GET /` - èŽ·å–æ´»è·ƒæœºæž„åˆ—è¡¨
- `GET /{capital_name}` - èŽ·å–æœºæž„è¯¦æƒ…

#### 3.8 äº¤æ˜“æ—¥åŽ† (`/api/v1/trading-calendar/`)
- `GET /` - èŽ·å–äº¤æ˜“æ—¥åŽ†åˆ—è¡¨
- `GET /{calendar_id}` - èŽ·å–äº¤æ˜“æ—¥åŽ†è¯¦æƒ…
- `POST /` - åˆ›å»ºäº¤æ˜“æ—¥åŽ†
- `PUT /{calendar_id}` - æ›´æ–°äº¤æ˜“æ—¥åŽ†
- `DELETE /{calendar_id}` - åˆ é™¤äº¤æ˜“æ—¥åŽ†
- `POST /upload-image` - ä¸Šä¼ å›¾ç‰‡

#### 3.9 ä»»åŠ¡ç®¡ç† (`/api/v1/tasks/`)
- `GET /executions` - èŽ·å–ä»»åŠ¡æ‰§è¡Œåˆ—è¡¨
- `GET /executions/{execution_id}` - èŽ·å–ä»»åŠ¡æ‰§è¡Œè¯¦æƒ…
- `GET /status` - èŽ·å–ä»»åŠ¡çŠ¶æ€
- `POST /run` - è¿è¡Œä»»åŠ¡
- `GET /task-types` - èŽ·å–ä»»åŠ¡ç±»åž‹

### 4. ä¾èµ–æ£€æŸ¥

#### 4.1 æ ¸å¿ƒä¾èµ– (`requirements.txt`)
- âœ… FastAPI >= 0.104.1
- âœ… Mangum >= 0.17.0 (CloudBase é€‚é…å™¨)
- âœ… SQLAlchemy >= 2.0.23
- âœ… Alembic >= 1.12.1 (æ•°æ®åº“è¿ç§»)
- âœ… Pydantic >= 2.5.0, < 3.0.0
- âœ… å…¶ä»–ä¾èµ–å®Œæ•´

### 5. æ•°æ®åº“è¿ç§»

#### 5.1 è¿ç§»æ–‡ä»¶
- âš ï¸ **éœ€è¦ç¡®è®¤**: `functions/trading-api/app/utils/migrate.py` æ˜¯å¦å­˜åœ¨
- âœ… `backend/app/utils/migrate.py` å­˜åœ¨

#### 5.2 è¿ç§»é€»è¾‘
- âœ… åœ¨äº‘å‡½æ•°å¯åŠ¨æ—¶è‡ªåŠ¨è¿è¡Œè¿ç§»
- âœ… é”™è¯¯å¤„ç†ï¼ˆéžè‡´å‘½é”™è¯¯ï¼‰
- âœ… åªè¿è¡Œä¸€æ¬¡ï¼ˆä½¿ç”¨å…¨å±€æ ‡å¿—ï¼‰

### 6. CORS é…ç½®

#### 6.1 é…ç½®é¡¹
- âœ… æ­£åˆ™è¡¨è¾¾å¼åŒ¹é… CloudBase åŸŸå
- âœ… ç²¾ç¡®åŒ¹é…æœ¬åœ°å¼€å‘åŸŸå
- âœ… æ‰€æœ‰å¼‚å¸¸å“åº”åŒ…å« CORS å¤´
- âœ… OPTIONS è¯·æ±‚å¤„ç†

#### 6.2 å…è®¸çš„æº
- âœ… `https://trade-view-0gtiozig72c07cd0.tcloudbaseapp.com`
- âœ… `https://trade-view-0gtiozig72c07cd0-1306563949.tcloudbaseapp.com`
- âœ… æ‰€æœ‰ `*.tcloudbaseapp.com` å­åŸŸåï¼ˆé€šè¿‡æ­£åˆ™ï¼‰

### 7. æ½œåœ¨é—®é¢˜

#### 7.1 éœ€è¦ä¿®å¤
1. âš ï¸ **migrate.py æ–‡ä»¶**: éœ€è¦ç¡®è®¤æ˜¯å¦å·²å¤åˆ¶åˆ° `functions/trading-api/app/utils/`
2. âš ï¸ **Alembic é…ç½®**: éœ€è¦ç¡®è®¤ `alembic.ini` å’Œ `alembic/` ç›®å½•æ˜¯å¦åœ¨äº‘å‡½æ•°ä¸­

#### 7.2 å»ºè®®æ”¹è¿›
1. æ·»åŠ å¥åº·æ£€æŸ¥ç«¯ç‚¹è¿”å›žæ›´å¤šä¿¡æ¯
2. æ·»åŠ  API ç‰ˆæœ¬ä¿¡æ¯
3. æ·»åŠ è¯·æ±‚æ—¥å¿—è®°å½•
4. æ·»åŠ æ€§èƒ½ç›‘æŽ§

## ðŸ”§ ä¿®å¤å»ºè®®

### 1. å¤åˆ¶ migrate.py æ–‡ä»¶

å¦‚æžœ `migrate.py` ä¸å­˜åœ¨ï¼Œéœ€è¦å¤åˆ¶ï¼š

```bash
cp backend/app/utils/migrate.py functions/trading-api/app/utils/migrate.py
```

### 2. ç¡®ä¿ Alembic æ–‡ä»¶å­˜åœ¨

ç¡®ä¿ä»¥ä¸‹æ–‡ä»¶/ç›®å½•åœ¨äº‘å‡½æ•°ä¸­ï¼š
- `alembic.ini`
- `alembic/` ç›®å½•

### 3. æµ‹è¯•æ•°æ®åº“è¿žæŽ¥

åœ¨äº‘å‡½æ•°å¯åŠ¨æ—¶æµ‹è¯•æ•°æ®åº“è¿žæŽ¥ï¼Œç¡®ä¿é…ç½®æ­£ç¡®ã€‚

## ðŸ“Š æ€»ç»“

### âœ… æ­£å¸¸é¡¹ç›®
- ä»£ç ç»“æž„å®Œæ•´
- API ç«¯ç‚¹é½å…¨
- CORS é…ç½®æ­£ç¡®
- å¼‚å¸¸å¤„ç†å®Œå–„

### âš ï¸ éœ€è¦æ³¨æ„
- migrate.py æ–‡ä»¶ä½ç½®
- Alembic é…ç½®ä½ç½®
- æ•°æ®åº“è¿žæŽ¥é…ç½®

### ðŸŽ¯ ä¸‹ä¸€æ­¥
1. ç¡®è®¤ migrate.py æ–‡ä»¶ä½ç½®
2. æµ‹è¯• API ç«¯ç‚¹
3. æ£€æŸ¥äº‘å‡½æ•°æ—¥å¿—
4. éªŒè¯æ•°æ®åº“è¿žæŽ¥
