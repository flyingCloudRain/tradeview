# äº¤æ˜“å¤ç›˜ç³»ç»Ÿè®¾è®¡æ–¹æ¡ˆ

## 1. ç³»ç»Ÿæ¦‚è¿°

### 1.1 ç³»ç»Ÿç›®æ ‡
æ„å»ºä¸€ä¸ªå‰åç«¯åˆ†ç¦»çš„äº¤æ˜“å¤ç›˜ç³»ç»Ÿï¼Œæä¾›å…¨é¢çš„Aè‚¡å¸‚åœºæ•°æ®åˆ†æåŠŸèƒ½ï¼ŒåŒ…æ‹¬é¾™è™æ¦œã€æ¸¸èµ„æ¦œã€å¤§ç›˜æŒ‡æ•°ã€æ¦‚å¿µæ¿å—ã€ä¸ªè‚¡èµ„é‡‘æµå’Œæ¶¨åœåˆ†æç­‰æ ¸å¿ƒåŠŸèƒ½ã€‚

### 1.2 æ ¸å¿ƒåŠŸèƒ½æ¨¡å—
- ğŸ“Š **é¾™è™æ¦œæŸ¥è¯¢ä¸åˆ†æ**ï¼šæŸ¥è¯¢æ¯æ—¥é¾™è™æ¦œæ•°æ®ï¼Œåˆ†ææœºæ„ä¹°å…¥å–å‡ºæƒ…å†µ
- ğŸ’° **æ¸¸èµ„æ¦œæŸ¥è¯¢ä¸åˆ†æ**ï¼šè¿½è¸ªæ¸¸èµ„äº¤æ˜“è¡Œä¸ºï¼Œåˆ†ææ¸¸èµ„æ“ä½œæ¨¡å¼
- ğŸ“ˆ **æ¯æ—¥å¤§ç›˜æŒ‡æ•°ç›‘æ§**ï¼šå®æ—¶ç›‘æ§ä¸»è¦æŒ‡æ•°æ¶¨è·Œæƒ…å†µ
- ğŸ¢ **æ¦‚å¿µæ¿å—ä¸Šæ¶¨æƒ…å†µåˆ†æ**ï¼šåˆ†ææ¦‚å¿µæ¿å—è¡¨ç°ï¼Œè¯†åˆ«çƒ­ç‚¹æ¿å—
- ğŸ’¸ **ä¸ªè‚¡èµ„é‡‘æµåˆ†æ**ï¼šåˆ†æä¸ªè‚¡èµ„é‡‘æµå…¥æµå‡ºæƒ…å†µ
- ğŸš€ **æ¶¨åœä¸ªè‚¡åˆ†æ**ï¼šåˆ†ææ¶¨åœè‚¡ç¥¨ç‰¹å¾å’ŒåŸå› 

### 1.3 ç”¨æˆ·è§’è‰²
- **äº¤æ˜“å‘˜**ï¼šæŸ¥çœ‹å¸‚åœºæ•°æ®ï¼Œè¿›è¡Œäº¤æ˜“å¤ç›˜
- **åˆ†æå¸ˆ**ï¼šæ·±åº¦åˆ†æå¸‚åœºè¶‹åŠ¿å’Œä¸ªè‚¡è¡¨ç°
- **ç®¡ç†å‘˜**ï¼šç³»ç»Ÿç®¡ç†å’Œæ•°æ®ç»´æŠ¤

## 2. ç³»ç»Ÿæ¶æ„è®¾è®¡

### 2.1 æ•´ä½“æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   å‰ç«¯ (Vue 3)   â”‚
â”‚  - Webç•Œé¢      â”‚
â”‚  - æ•°æ®å¯è§†åŒ–    â”‚
â”‚  - ç”¨æˆ·äº¤äº’      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚ HTTP/HTTPS
         â”‚ RESTful API
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   åç«¯ (FastAPI) â”‚
â”‚  - APIæœåŠ¡      â”‚
â”‚  - ä¸šåŠ¡é€»è¾‘      â”‚
â”‚  - æ•°æ®èšåˆ      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ•°æ®å±‚ (Supabase)â”‚
â”‚  - PostgreSQL   â”‚
â”‚  - å®æ—¶è®¢é˜…      â”‚
â”‚  - å­˜å‚¨æœåŠ¡      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å¤–éƒ¨æ•°æ®æº      â”‚
â”‚  - AKShare API  â”‚
â”‚  - å…¶ä»–æ•°æ®æ¥å£  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 æŠ€æœ¯æ ˆé€‰æ‹©

#### å‰ç«¯æŠ€æœ¯æ ˆ
- **æ¡†æ¶**: Vue 3 + TypeScript
- **æ„å»ºå·¥å…·**: Vite
- **UIç»„ä»¶åº“**: Element Plus
- **çŠ¶æ€ç®¡ç†**: Pinia
- **è·¯ç”±**: Vue Router 4
- **æ•°æ®å¯è§†åŒ–**: ECharts
- **HTTPå®¢æˆ·ç«¯**: Axios
- **ç»„åˆå¼API**: Composition API

#### åç«¯æŠ€æœ¯æ ˆ
- **æ¡†æ¶**: FastAPI (Python 3.11+)
- **ORM**: SQLAlchemy 2.0
- **æ•°æ®åº“**: Supabase (PostgreSQL)
- **æ•°æ®è·å–**: AKShare
- **ä»»åŠ¡è°ƒåº¦**: APScheduler
- **ç¼“å­˜**: Redis (å¯é€‰)
- **è®¤è¯**: Supabase Auth

#### æ•°æ®åº“
- **ä¸»æ•°æ®åº“**: Supabase PostgreSQL
- **å®æ—¶è®¢é˜…**: Supabase Realtime
- **å­˜å‚¨**: Supabase Storage (ç”¨äºæ–‡ä»¶å­˜å‚¨)

### 2.3 æ¶æ„ç‰¹ç‚¹
- **å‰åç«¯åˆ†ç¦»**ï¼šå‰ç«¯å’Œåç«¯ç‹¬ç«‹å¼€å‘ã€éƒ¨ç½²
- **RESTful API**ï¼šæ ‡å‡†åŒ–APIæ¥å£è®¾è®¡
- **å¾®æœåŠ¡åŒ–**ï¼šæ¨¡å—åŒ–è®¾è®¡ï¼Œæ˜“äºæ‰©å±•
- **å®æ—¶æ•°æ®**ï¼šæ”¯æŒå®æ—¶æ•°æ®æ¨é€
- **é«˜æ€§èƒ½**ï¼šå¼‚æ­¥å¤„ç†ï¼Œæ”¯æŒé«˜å¹¶å‘

## 3. æ•°æ®åº“è®¾è®¡

### 3.1 æ ¸å¿ƒæ•°æ®è¡¨

#### 3.1.1 é¾™è™æ¦œè¡¨ (lhb_detail)
```sql
CREATE TABLE lhb_detail (
    id SERIAL PRIMARY KEY,
    date DATE NOT NULL,
    stock_code VARCHAR(10) NOT NULL,
    stock_name VARCHAR(50) NOT NULL,
    close_price DECIMAL(10, 2),
    change_percent DECIMAL(5, 2),
    net_buy_amount DECIMAL(15, 2),
    buy_amount DECIMAL(15, 2),
    sell_amount DECIMAL(15, 2),
    total_amount DECIMAL(15, 2),
    turnover_rate DECIMAL(5, 2),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    UNIQUE(date, stock_code)
);

CREATE INDEX idx_lhb_date ON lhb_detail(date);
CREATE INDEX idx_lhb_stock_code ON lhb_detail(stock_code);
```

#### 3.1.2 é¾™è™æ¦œæœºæ„æ˜ç»†è¡¨ (lhb_institution)
```sql
CREATE TABLE lhb_institution (
    id SERIAL PRIMARY KEY,
    lhb_detail_id INTEGER REFERENCES lhb_detail(id),
    date DATE NOT NULL,
    stock_code VARCHAR(10) NOT NULL,
    institution_name VARCHAR(100),
    buy_amount DECIMAL(15, 2),
    sell_amount DECIMAL(15, 2),
    net_buy_amount DECIMAL(15, 2),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE INDEX idx_lhb_institution_date ON lhb_institution(date);
CREATE INDEX idx_lhb_institution_stock ON lhb_institution(stock_code);
```

#### 3.1.3 æ´»è·ƒæœºæ„è¡¨ (capital_detail)
```sql
CREATE TABLE capital_detail (
    id SERIAL PRIMARY KEY,
    date DATE NOT NULL,
    capital_name VARCHAR(100) NOT NULL,
    stock_code VARCHAR(10) NOT NULL,
    stock_name VARCHAR(50) NOT NULL,
    buy_amount DECIMAL(15, 2),
    sell_amount DECIMAL(15, 2),
    net_buy_amount DECIMAL(15, 2),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    UNIQUE(date, capital_name, stock_code)
);

CREATE INDEX idx_capital_date ON capital_detail(date);
CREATE INDEX idx_capital_name ON capital_detail(capital_name);
```

#### 3.1.4 å¤§ç›˜æŒ‡æ•°è¡¨ (index_history)
```sql
CREATE TABLE index_history (
    id SERIAL PRIMARY KEY,
    date DATE NOT NULL,
    index_code VARCHAR(20) NOT NULL,
    index_name VARCHAR(50) NOT NULL,
    close_price DECIMAL(10, 2),
    change_percent DECIMAL(5, 2),
    volume BIGINT,
    amount DECIMAL(15, 2),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    UNIQUE(date, index_code)
);

CREATE INDEX idx_index_date ON index_history(date);
CREATE INDEX idx_index_code ON index_history(index_code);
```

#### 3.1.5 æ¦‚å¿µæ¿å—è¡¨ (sector_history)
```sql
CREATE TABLE sector_history (
    id SERIAL PRIMARY KEY,
    date DATE NOT NULL,
    sector_code VARCHAR(20) NOT NULL,
    sector_name VARCHAR(50) NOT NULL,
    change_percent DECIMAL(5, 2),
    rise_count INTEGER,
    fall_count INTEGER,
    total_count INTEGER,
    total_amount DECIMAL(15, 2),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    UNIQUE(date, sector_code)
);

CREATE INDEX idx_sector_date ON sector_history(date);
CREATE INDEX idx_sector_code ON sector_history(sector_code);
```

#### 3.1.6 ä¸ªè‚¡èµ„é‡‘æµè¡¨ (stock_fund_flow)
```sql
CREATE TABLE stock_fund_flow (
    id SERIAL PRIMARY KEY,
    date DATE NOT NULL,
    stock_code VARCHAR(10) NOT NULL,
    stock_name VARCHAR(50) NOT NULL,
    main_inflow DECIMAL(15, 2),
    main_outflow DECIMAL(15, 2),
    main_net_inflow DECIMAL(15, 2),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    turnover_rate DECIMAL(5, 2),
    UNIQUE(date, stock_code)
);

CREATE INDEX idx_fund_flow_date ON stock_fund_flow(date);
CREATE INDEX idx_fund_flow_stock ON stock_fund_flow(stock_code);
```

#### 3.1.7 æ¶¨åœæ± è¡¨ (zt_pool)
```sql
CREATE TABLE zt_pool (
    id SERIAL PRIMARY KEY,
    date DATE NOT NULL,
    stock_code VARCHAR(10) NOT NULL,
    stock_name VARCHAR(50) NOT NULL,
    change_percent DECIMAL(5, 2),              -- æ¶¨è·Œå¹… (%)
    latest_price DECIMAL(10, 2),               -- æœ€æ–°ä»·
    turnover_amount BIGINT,                    -- æˆäº¤é¢
    circulation_market_value DECIMAL(15, 2),   -- æµé€šå¸‚å€¼
    total_market_value DECIMAL(15, 2),         -- æ€»å¸‚å€¼
    turnover_rate DECIMAL(5, 2),               -- æ¢æ‰‹ç‡ (%)
    limit_up_capital BIGINT,                   -- å°æ¿èµ„é‡‘
    first_limit_time TIME,                     -- é¦–æ¬¡å°æ¿æ—¶é—´ (æ ¼å¼: 09:25:00)
    last_limit_time TIME,                      -- æœ€åå°æ¿æ—¶é—´ (æ ¼å¼: 09:25:00)
    explosion_count INTEGER DEFAULT 0,          -- ç‚¸æ¿æ¬¡æ•°
    limit_up_statistics TEXT,                  -- æ¶¨åœç»Ÿè®¡
    consecutive_limit_count INTEGER,            -- è¿æ¿æ•° (1 ä¸ºé¦–æ¿)
    industry VARCHAR(100),                     -- æ‰€å±è¡Œä¸š
    concept TEXT,                               -- æ¦‚å¿µ (å¤šä¸ªæ¦‚å¿µç”¨é€—å·åˆ†éš”æˆ–JSONæ ¼å¼)
    limit_up_reason TEXT,                       -- æ¶¨åœåŸå› 
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    UNIQUE(date, stock_code)
);

CREATE INDEX idx_zt_pool_date ON zt_pool(date);
CREATE INDEX idx_zt_pool_stock ON zt_pool(stock_code);
CREATE INDEX idx_zt_pool_industry ON zt_pool(industry);
CREATE INDEX idx_zt_pool_consecutive ON zt_pool(consecutive_limit_count);
CREATE INDEX idx_zt_pool_concept ON zt_pool USING GIN(to_tsvector('simple', concept));  -- æ¦‚å¿µå…¨æ–‡æœç´¢ç´¢å¼•
```

### 3.2 æ•°æ®å…³ç³»å›¾

```
lhb_detail (1) â”€â”€< (N) lhb_institution
index_history
sector_history
stock_fund_flow
zt_pool
capital_detail
```

## 4. APIè®¾è®¡

### 4.1 APIè§„èŒƒ

#### 4.1.1 ç»Ÿä¸€å“åº”æ ¼å¼
```json
{
  "code": 200,
  "message": "success",
  "data": {},
  "timestamp": "2024-01-01T00:00:00Z"
}
```

#### 4.1.2 é”™è¯¯ç å®šä¹‰
- `200`: æˆåŠŸ
- `400`: è¯·æ±‚å‚æ•°é”™è¯¯
- `401`: æœªæˆæƒ
- `403`: ç¦æ­¢è®¿é—®
- `404`: èµ„æºä¸å­˜åœ¨
- `500`: æœåŠ¡å™¨å†…éƒ¨é”™è¯¯

### 4.2 æ ¸å¿ƒAPIæ¥å£

#### 4.2.1 é¾™è™æ¦œAPI

**è·å–é¾™è™æ¦œåˆ—è¡¨**
```
GET /api/v1/lhb
Query Parameters:
  - date: string (required) - æ—¥æœŸï¼Œæ ¼å¼ï¼šYYYY-MM-DD
  - stock_code: string (optional) - è‚¡ç¥¨ä»£ç 
  - page: integer (optional) - é¡µç ï¼Œé»˜è®¤1
  - page_size: integer (optional) - æ¯é¡µæ•°é‡ï¼Œé»˜è®¤20
  - sort_by: string (optional) - æ’åºå­—æ®µ
  - order: string (optional) - æ’åºæ–¹å‘ï¼Œasc/desc

Response:
{
  "code": 200,
  "data": {
    "items": [...],
    "total": 100,
    "page": 1,
    "page_size": 20,
    "total_pages": 5
  }
}
```

**è·å–é¾™è™æ¦œè¯¦æƒ…**
```
GET /api/v1/lhb/{stock_code}
Query Parameters:
  - date: string (required) - æ—¥æœŸ

Response:
{
  "code": 200,
  "data": {
    "detail": {...},
    "institutions": [...],
    "capital": [...]
  }
}
```

**è·å–æœºæ„æ˜ç»†**
```
GET /api/v1/lhb/{stock_code}/institution
Query Parameters:
  - date: string (required) - æ—¥æœŸ

Response:
{
  "code": 200,
  "data": [...]
}
```

**è·å–æ¸¸èµ„æ˜ç»†**
```
GET /api/v1/lhb/{stock_code}/capital
Query Parameters:
  - date: string (required) - æ—¥æœŸ

Response:
{
  "code": 200,
  "data": [...]
}
```

#### 4.2.2 æ¸¸èµ„æ¦œAPI

**è·å–æ¸¸èµ„æ¦œåˆ—è¡¨**
```
GET /api/v1/capital
Query Parameters:
  - date: string (required) - æ—¥æœŸ
  - capital_name: string (optional) - æ¸¸èµ„åç§°
  - page: integer (optional)
  - page_size: integer (optional)

Response:
{
  "code": 200,
  "data": {
    "items": [...],
    "total": 100,
    "page": 1,
    "page_size": 20
  }
}
```

**è·å–æ¸¸èµ„è¯¦æƒ…**
```
GET /api/v1/capital/{capital_name}
Query Parameters:
  - date: string (required) - æ—¥æœŸ

Response:
{
  "code": 200,
  "data": {...}
}
```

#### 4.2.3 å¤§ç›˜æŒ‡æ•°API

**è·å–æŒ‡æ•°åˆ—è¡¨**
```
GET /api/v1/index
Query Parameters:
  - date: string (required) - æ—¥æœŸ
  - index_code: string (optional) - æŒ‡æ•°ä»£ç 

Response:
{
  "code": 200,
  "data": [...]
}
```

**è·å–æŒ‡æ•°å†å²æ•°æ®**
```
GET /api/v1/index/{index_code}/history
Query Parameters:
  - start_date: string (required)
  - end_date: string (required)

Response:
{
  "code": 200,
  "data": [...]
}
```

#### 4.2.4 æ¦‚å¿µæ¿å—API

**è·å–æ¿å—åˆ—è¡¨**
```
GET /api/v1/sector
Query Parameters:
  - date: string (required) - æ—¥æœŸ
  - sector_code: string (optional) - æ¿å—ä»£ç 
  - sort_by: string (optional) - æ’åºå­—æ®µï¼Œå¦‚change_percent
  - order: string (optional) - æ’åºæ–¹å‘

Response:
{
  "code": 200,
  "data": [...]
}
```

**è·å–æ¿å—è¯¦æƒ…**
```
GET /api/v1/sector/{sector_code}
Query Parameters:
  - date: string (required) - æ—¥æœŸ

Response:
{
  "code": 200,
  "data": {...}
}
```

#### 4.2.5 èµ„é‡‘æµAPI

**è·å–ä¸ªè‚¡èµ„é‡‘æµ**
```
GET /api/v1/stock-fund-flow
Query Parameters:
  - date: string (required) - æ—¥æœŸ
  - stock_code: string (optional) - è‚¡ç¥¨ä»£ç 
  - page: integer (optional)
  - page_size: integer (optional)

Response:
{
  "code": 200,
  "data": {
    "items": [...],
    "total": 100
  }
}
```

**è·å–èµ„é‡‘æµå†å²**
```
GET /api/v1/stock-fund-flow/{stock_code}/history
Query Parameters:
  - start_date: string (required)
  - end_date: string (required)

Response:
{
  "code": 200,
  "data": [...]
}
```

#### 4.2.6 æ¶¨åœæ± API

**è·å–æ¶¨åœæ± åˆ—è¡¨**
```
GET /api/v1/zt-pool
Query Parameters:
  - date: string (required) - æ—¥æœŸ
  - stock_code: string (optional) - è‚¡ç¥¨ä»£ç 
  - concept: string (optional) - æ¦‚å¿µç­›é€‰
  - industry: string (optional) - è¡Œä¸šç­›é€‰
  - consecutive_limit_count: integer (optional) - è¿æ¿æ•°ç­›é€‰
  - page: integer (optional)
  - page_size: integer (optional)
  - sort_by: string (optional) - æ’åºå­—æ®µï¼Œå¦‚change_percent, turnover_amount
  - order: string (optional) - æ’åºæ–¹å‘ï¼Œasc/desc

Response:
{
  "code": 200,
  "data": {
    "items": [
      {
        "id": 1,
        "date": "2024-01-01",
        "stock_code": "000001",
        "stock_name": "å¹³å®‰é“¶è¡Œ",
        "change_percent": 10.00,
        "latest_price": 12.50,
        "turnover_amount": 1000000000,
        "circulation_market_value": 50000000000,
        "total_market_value": 60000000000,
        "turnover_rate": 5.20,
        "limit_up_capital": 500000000,
        "first_limit_time": "09:25:00",
        "last_limit_time": "14:30:00",
        "explosion_count": 0,
        "limit_up_statistics": "é¦–æ¬¡æ¶¨åœ",
        "consecutive_limit_count": 1,
        "industry": "é“¶è¡Œ",
        "concept": "é‡‘èç§‘æŠ€,æ•°å­—è´§å¸",
        "limit_up_reason": "æ”¿ç­–åˆ©å¥½ï¼Œé‡‘èç§‘æŠ€æ¦‚å¿µå—å…³æ³¨"
      }
    ],
    "total": 100,
    "page": 1,
    "page_size": 20,
    "total_pages": 5
  }
}
```

**è·å–æ¶¨åœåˆ†æ**
```
GET /api/v1/zt-pool/analysis
Query Parameters:
  - date: string (required) - æ—¥æœŸ

Response:
{
  "code": 200,
  "data": {
    "total_count": 100,
    "industry_distribution": {
      "é“¶è¡Œ": 10,
      "ç§‘æŠ€": 25,
      "åŒ»è¯": 15
    },
    "concept_distribution": {
      "é‡‘èç§‘æŠ€": 20,
      "æ•°å­—è´§å¸": 15,
      "äººå·¥æ™ºèƒ½": 18
    },
    "reason_distribution": {
      "æ”¿ç­–åˆ©å¥½": 30,
      "ä¸šç»©è¶…é¢„æœŸ": 25,
      "æ¦‚å¿µç‚’ä½œ": 20,
      "æŠ€æœ¯çªç ´": 15,
      "å…¶ä»–": 10
    },
    "consecutive_limit_distribution": {
      "1": 60,
      "2": 25,
      "3": 10,
      "4+": 5
    }
  }
}
```

## 5. å‰ç«¯è®¾è®¡

### 5.1 é¡µé¢ç»“æ„

```
Dashboard (ä»ªè¡¨ç›˜)
â”œâ”€â”€ ä»Šæ—¥æ¦‚è§ˆ
â”‚   â”œâ”€â”€ å¤§ç›˜æŒ‡æ•°
â”‚   â”œâ”€â”€ æ¶¨åœä¸ªè‚¡
åœè·Œæ•°é‡    
â”‚   â”œâ”€â”€ é¾™è™æ¦œæ•°é‡
â”‚   â””â”€â”€ æ¿å—æ¶¨è·Œç»Ÿè®¡
â””â”€â”€ å¿«é€Ÿå…¥å£
    â”œâ”€â”€ é¾™è™æ¦œ
    â”œâ”€â”€ æ¸¸èµ„æ¦œ
    â”œâ”€â”€ æ¶¨åœæ± 
    â””â”€â”€ èµ„é‡‘æµ

Lhb (é¾™è™æ¦œ)
â”œâ”€â”€ List (åˆ—è¡¨é¡µ)
â”‚   â”œâ”€â”€ æ—¥æœŸé€‰æ‹©å™¨
â”‚   â”œâ”€â”€ è‚¡ç¥¨ä»£ç ç­›é€‰
â”‚   â”œâ”€â”€ æ•°æ®è¡¨æ ¼
â”‚   â”‚   â”œâ”€â”€ è‚¡ç¥¨ä»£ç /åç§°
â”‚   â”‚   â”œâ”€â”€ æ¶¨è·Œå¹…
â”‚   â”‚   â”œâ”€â”€ å‡€ä¹°é¢
â”‚   â”‚   â”œâ”€â”€ ä¹°å…¥/å–å‡ºé¢
â”‚   â”‚   â”œâ”€â”€ æ¢æ‰‹ç‡
â”‚   â”‚   â””â”€â”€ ä¸Šæ¦œåŸå› 
â”‚   â””â”€â”€ åˆ†é¡µç»„ä»¶
â””â”€â”€ Detail (è¯¦æƒ…é¡µ)
    â”œâ”€â”€ åŸºæœ¬ä¿¡æ¯
    â”œâ”€â”€ æœºæ„æ˜ç»†
    â”œâ”€â”€ æ¸¸èµ„æ˜ç»†
    â””â”€â”€ å†å²æ•°æ®å›¾è¡¨

Capital (æ¸¸èµ„æ¦œ)
â”œâ”€â”€ List (åˆ—è¡¨é¡µ)
â”‚   â”œâ”€â”€ æ—¥æœŸé€‰æ‹©å™¨
â”‚   â”œâ”€â”€ æ¸¸èµ„åç§°ç­›é€‰
â”‚   â”œâ”€â”€ æ•°æ®è¡¨æ ¼
â”‚   â””â”€â”€ åˆ†é¡µç»„ä»¶
â””â”€â”€ Detail (è¯¦æƒ…é¡µ)
    â”œâ”€â”€ æ¸¸èµ„ä¿¡æ¯
    â”œâ”€â”€ æ“ä½œè‚¡ç¥¨åˆ—è¡¨
    â””â”€â”€ å†å²æ“ä½œç»Ÿè®¡

Index (å¤§ç›˜æŒ‡æ•°)
â”œâ”€â”€ æŒ‡æ•°åˆ—è¡¨
â”‚   â”œâ”€â”€ ä¸»è¦æŒ‡æ•°å¡ç‰‡
â”‚   â””â”€â”€ æ¶¨è·Œç»Ÿè®¡
â””â”€â”€ æŒ‡æ•°è¯¦æƒ…
    â”œâ”€â”€ å®æ—¶æ•°æ®
    â””â”€â”€ å†å²èµ°åŠ¿å›¾

Sector (æ¦‚å¿µæ¿å—)
â”œâ”€â”€ æ¿å—åˆ—è¡¨
â”‚   â”œâ”€â”€ æ—¥æœŸé€‰æ‹©å™¨
â”‚   â”œâ”€â”€ æ¿å—ç­›é€‰
â”‚   â”œâ”€â”€ æ•°æ®è¡¨æ ¼
â”‚   â””â”€â”€ æ’åºåŠŸèƒ½
â””â”€â”€ æ¿å—è¯¦æƒ…
    â”œâ”€â”€ æ¿å—ä¿¡æ¯
    â”œâ”€â”€ æˆåˆ†è‚¡åˆ—è¡¨
    â””â”€â”€ å†å²èµ°åŠ¿

FundFlow (èµ„é‡‘æµ)
â”œâ”€â”€ èµ„é‡‘æµåˆ—è¡¨
â”‚   â”œâ”€â”€ æ—¥æœŸé€‰æ‹©å™¨
â”‚   â”œâ”€â”€ è‚¡ç¥¨ç­›é€‰
â”‚   â”œâ”€â”€ æ•°æ®è¡¨æ ¼
â”‚   â””â”€â”€ åˆ†é¡µç»„ä»¶
â””â”€â”€ ä¸ªè‚¡èµ„é‡‘æµè¯¦æƒ…
    â”œâ”€â”€ èµ„é‡‘æµæ•°æ®
    â””â”€â”€ å†å²èµ„é‡‘æµå›¾è¡¨

ZtPool (æ¶¨åœæ± )
â”œâ”€â”€ æ¶¨åœåˆ—è¡¨
â”‚   â”œâ”€â”€ æ—¥æœŸé€‰æ‹©å™¨
â”‚   â”œâ”€â”€ è‚¡ç¥¨ç­›é€‰
â”‚   â”œâ”€â”€ æ¦‚å¿µç­›é€‰
â”‚   â”œâ”€â”€ è¡Œä¸šç­›é€‰
â”‚   â”œâ”€â”€ è¿æ¿æ•°ç­›é€‰
â”‚   â”œâ”€â”€ æ•°æ®è¡¨æ ¼
â”‚   â”‚   â”œâ”€â”€ è‚¡ç¥¨ä»£ç /åç§°
â”‚   â”‚   â”œâ”€â”€ æ¶¨è·Œå¹…
â”‚   â”‚   â”œâ”€â”€ æœ€æ–°ä»·
â”‚   â”‚   â”œâ”€â”€ æˆäº¤é¢
â”‚   â”‚   â”œâ”€â”€ æ¢æ‰‹ç‡
â”‚   â”‚   â”œâ”€â”€ å°æ¿èµ„é‡‘
â”‚   â”‚   â”œâ”€â”€ é¦–æ¬¡/æœ€åå°æ¿æ—¶é—´
â”‚   â”‚   â”œâ”€â”€ ç‚¸æ¿æ¬¡æ•°
â”‚   â”‚   â”œâ”€â”€ è¿æ¿æ•°
â”‚   â”‚   â”œâ”€â”€ æ‰€å±è¡Œä¸š
â”‚   â”‚   â”œâ”€â”€ æ¦‚å¿µ
â”‚   â”‚   â””â”€â”€ æ¶¨åœåŸå› 
â”‚   â””â”€â”€ åˆ†é¡µç»„ä»¶
â””â”€â”€ æ¶¨åœåˆ†æ
    â”œâ”€â”€ æ¶¨åœç»Ÿè®¡
    â”œâ”€â”€ è¡Œä¸šåˆ†å¸ƒ
    â”œâ”€â”€ æ¦‚å¿µåˆ†å¸ƒ
    â”œâ”€â”€ åŸå› åˆ†å¸ƒ
    â””â”€â”€ è¿æ¿æ•°åˆ†å¸ƒ
```

### 5.2 ç»„ä»¶è®¾è®¡

#### 5.2.1 å…¬å…±ç»„ä»¶

**DataTableç»„ä»¶**
- æ”¯æŒæ’åºã€ç­›é€‰ã€åˆ†é¡µ
- å¯é…ç½®åˆ—æ˜¾ç¤º
- æ”¯æŒè‡ªå®šä¹‰æ¸²æŸ“

**Chartç»„ä»¶**
- åŸºäºEChartså°è£…
- æ”¯æŒå¤šç§å›¾è¡¨ç±»å‹
- å“åº”å¼è®¾è®¡

**Filterç»„ä»¶**
- æ—¥æœŸé€‰æ‹©å™¨
- è‚¡ç¥¨ä»£ç è¾“å…¥
- æ¦‚å¿µé€‰æ‹©å™¨ï¼ˆæ”¯æŒå¤šé€‰ï¼‰
- è¡Œä¸šé€‰æ‹©å™¨
- è¿æ¿æ•°é€‰æ‹©å™¨
- ä¸‹æ‹‰é€‰æ‹©å™¨

**Layoutç»„ä»¶**
- é¡¶éƒ¨å¯¼èˆªæ 
- ä¾§è¾¹æ èœå•
- ä¸»å†…å®¹åŒº

### 5.3 çŠ¶æ€ç®¡ç†

ä½¿ç”¨Piniaç®¡ç†å…¨å±€çŠ¶æ€ï¼š

- **lhbStore**: é¾™è™æ¦œç›¸å…³çŠ¶æ€
- **capitalStore**: æ¸¸èµ„æ¦œç›¸å…³çŠ¶æ€
- **indexStore**: å¤§ç›˜æŒ‡æ•°çŠ¶æ€
- **sectorStore**: æ¿å—çŠ¶æ€
- **fundFlowStore**: èµ„é‡‘æµçŠ¶æ€
- **ztPoolStore**: æ¶¨åœæ± çŠ¶æ€

## 6. åç«¯è®¾è®¡

### 6.1 é¡¹ç›®ç»“æ„

```
backend/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ main.py              # FastAPIåº”ç”¨å…¥å£
â”‚   â”œâ”€â”€ config.py            # é…ç½®ç®¡ç†
â”‚   â”œâ”€â”€ dependencies.py      # ä¾èµ–æ³¨å…¥
â”‚   â”‚
â”‚   â”œâ”€â”€ api/                 # APIè·¯ç”±
â”‚   â”‚   â””â”€â”€ v1/
â”‚   â”‚       â”œâ”€â”€ lhb.py
â”‚   â”‚       â”œâ”€â”€ capital.py
â”‚   â”‚       â”œâ”€â”€ index.py
â”‚   â”‚       â”œâ”€â”€ sector.py
â”‚   â”‚       â”œâ”€â”€ fund_flow.py
â”‚   â”‚       â””â”€â”€ zt_pool.py
â”‚   â”‚
â”‚   â”œâ”€â”€ models/              # SQLAlchemyæ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ lhb.py
â”‚   â”‚   â”œâ”€â”€ capital.py
â”‚   â”‚   â”œâ”€â”€ index.py
â”‚   â”‚   â”œâ”€â”€ sector.py
â”‚   â”‚   â”œâ”€â”€ fund_flow.py
â”‚   â”‚   â””â”€â”€ zt_pool.py
â”‚   â”‚
â”‚   â”œâ”€â”€ schemas/             # Pydanticæ¨¡å¼
â”‚   â”‚   â”œâ”€â”€ lhb.py
â”‚   â”‚   â”œâ”€â”€ capital.py
â”‚   â”‚   â””â”€â”€ ...
â”‚   â”‚
â”‚   â”œâ”€â”€ services/            # ä¸šåŠ¡é€»è¾‘å±‚
â”‚   â”‚   â”œâ”€â”€ lhb_service.py
â”‚   â”‚   â”œâ”€â”€ capital_service.py
â”‚   â”‚   â””â”€â”€ ...
â”‚   â”‚
â”‚   â”œâ”€â”€ database/            # æ•°æ®åº“ç›¸å…³
â”‚   â”‚   â”œâ”€â”€ base.py
â”‚   â”‚   â”œâ”€â”€ session.py
â”‚   â”‚   â””â”€â”€ supabase.py
â”‚   â”‚
â”‚   â”œâ”€â”€ utils/               # å·¥å…·å‡½æ•°
â”‚   â”‚   â”œâ”€â”€ akshare_utils.py
â”‚   â”‚   â”œâ”€â”€ date_utils.py
â”‚   â”‚   â””â”€â”€ format_utils.py
â”‚   â”‚
â”‚   â””â”€â”€ tasks/               # å®šæ—¶ä»»åŠ¡
â”‚       â”œâ”€â”€ scheduler.py
â”‚       â””â”€â”€ jobs/
â”‚           â”œâ”€â”€ lhb_job.py
â”‚           â”œâ”€â”€ index_job.py
â”‚           â””â”€â”€ sector_job.py
â”‚
â”œâ”€â”€ tests/                   # æµ‹è¯•
â”œâ”€â”€ alembic/                 # æ•°æ®åº“è¿ç§»
â”œâ”€â”€ requirements.txt
â””â”€â”€ README.md
```

### 6.2 æ ¸å¿ƒæœåŠ¡è®¾è®¡

#### 6.2.1 LhbService (é¾™è™æ¦œæœåŠ¡)
- `get_lhb_list()`: è·å–é¾™è™æ¦œåˆ—è¡¨
- `get_lhb_detail()`: è·å–é¾™è™æ¦œè¯¦æƒ…
- `get_institution_detail()`: è·å–æœºæ„æ˜ç»†
- `get_capital_detail()`: è·å–æ¸¸èµ„æ˜ç»†
- `save_lhb_data()`: ä¿å­˜é¾™è™æ¦œæ•°æ®

#### 6.2.2 CapitalService (æ¸¸èµ„æœåŠ¡)
- `get_capital_list()`: è·å–æ¸¸èµ„æ¦œåˆ—è¡¨
- `get_capital_detail()`: è·å–æ¸¸èµ„è¯¦æƒ…
- `get_capital_history()`: è·å–æ¸¸èµ„å†å²æ“ä½œ
- `save_capital_data()`: ä¿å­˜æ¸¸èµ„æ•°æ®

#### 6.2.3 IndexService (æŒ‡æ•°æœåŠ¡)
- `get_index_list()`: è·å–æŒ‡æ•°åˆ—è¡¨
- `get_index_history()`: è·å–æŒ‡æ•°å†å²æ•°æ®
- `save_index_data()`: ä¿å­˜æŒ‡æ•°æ•°æ®

#### 6.2.4 SectorService (æ¿å—æœåŠ¡)
- `get_sector_list()`: è·å–æ¿å—åˆ—è¡¨
- `get_sector_detail()`: è·å–æ¿å—è¯¦æƒ…
- `save_sector_data()`: ä¿å­˜æ¿å—æ•°æ®

#### 6.2.5 FundFlowService (èµ„é‡‘æµæœåŠ¡)
- `get_fund_flow_list()`: è·å–èµ„é‡‘æµåˆ—è¡¨
- `get_fund_flow_history()`: è·å–èµ„é‡‘æµå†å²
- `save_fund_flow_data()`: ä¿å­˜èµ„é‡‘æµæ•°æ®

#### 6.2.6 ZtPoolService (æ¶¨åœæ± æœåŠ¡)
- `get_zt_pool_list()`: è·å–æ¶¨åœæ± åˆ—è¡¨ï¼ˆæ”¯æŒæ¦‚å¿µã€è¡Œä¸šã€è¿æ¿æ•°ç­›é€‰ï¼‰
- `get_zt_analysis()`: è·å–æ¶¨åœåˆ†æï¼ˆåŒ…å«æ¦‚å¿µåˆ†å¸ƒã€åŸå› åˆ†å¸ƒç»Ÿè®¡ï¼‰
- `save_zt_pool_data()`: ä¿å­˜æ¶¨åœæ± æ•°æ®ï¼ˆåŒ…å«æ¦‚å¿µå’Œæ¶¨åœåŸå› ï¼‰
- `get_concept_list()`: è·å–æ¦‚å¿µåˆ—è¡¨ï¼ˆç”¨äºç­›é€‰ï¼‰
- `get_reason_statistics()`: è·å–æ¶¨åœåŸå› ç»Ÿè®¡

### 6.3 å®šæ—¶ä»»åŠ¡è®¾è®¡

ä½¿ç”¨APSchedulerå®ç°å®šæ—¶ä»»åŠ¡ï¼š

- **æ¯æ—¥æ•°æ®åŒæ­¥ä»»åŠ¡** (æ¯å¤©æ”¶ç›˜åæ‰§è¡Œ)
  - åŒæ­¥é¾™è™æ¦œæ•°æ®
  - åŒæ­¥æ¸¸èµ„æ¦œæ•°æ®
  - åŒæ­¥å¤§ç›˜æŒ‡æ•°æ•°æ®
  - åŒæ­¥æ¦‚å¿µæ¿å—æ•°æ®
  - åŒæ­¥èµ„é‡‘æµæ•°æ®
  - åŒæ­¥æ¶¨åœæ± æ•°æ®

- **æ•°æ®æ¸…ç†ä»»åŠ¡** (æ¯å‘¨æ‰§è¡Œ)
  - æ¸…ç†è¿‡æœŸæ•°æ®
  - æ•°æ®å½’æ¡£

## 7. éƒ¨ç½²æ–¹æ¡ˆ

### 7.1 éƒ¨ç½²æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Nginx      â”‚  (åå‘ä»£ç†)
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
   â”Œâ”€â”€â”€â”´â”€â”€â”€â”€â”
   â”‚        â”‚
â”Œâ”€â”€â–¼â”€â”€â”  â”Œâ”€â”€â–¼â”€â”€â”
â”‚å‰ç«¯ â”‚  â”‚åç«¯ â”‚
â”‚Vue3 â”‚  â”‚FastAPIâ”‚
â””â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”¬â”€â”€â”˜
            â”‚
     â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”
     â”‚  Supabase â”‚
     â”‚ PostgreSQLâ”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 7.2 éƒ¨ç½²æ­¥éª¤

#### 7.2.1 åç«¯éƒ¨ç½²
1. å®‰è£…Pythonä¾èµ–
2. é…ç½®ç¯å¢ƒå˜é‡
3. è¿è¡Œæ•°æ®åº“è¿ç§»
4. å¯åŠ¨FastAPIæœåŠ¡
5. é…ç½®Nginxåå‘ä»£ç†

#### 7.2.2 å‰ç«¯éƒ¨ç½²
1. æ„å»ºç”Ÿäº§ç‰ˆæœ¬
2. é…ç½®Nginxé™æ€æ–‡ä»¶æœåŠ¡
3. é…ç½®APIä»£ç†

#### 7.2.3 Supabaseé…ç½®
1. åˆ›å»ºæ•°æ®åº“
2. æ‰§è¡Œæ•°æ®åº“è¿ç§»
3. é…ç½®å®æ—¶è®¢é˜…
4. è®¾ç½®å­˜å‚¨æ¡¶

### 7.3 ç¯å¢ƒå˜é‡é…ç½®

**åç«¯ (.env)**
```
DATABASE_URL=postgresql://user:password@host:port/dbname
SUPABASE_URL=https://xxx.supabase.co
SUPABASE_KEY=xxx
REDIS_URL=redis://localhost:6379
```

**å‰ç«¯ (.env.production)**
```
VITE_API_BASE_URL=https://api.yourdomain.com/api/v1
```

## 8. å¼€å‘è®¡åˆ’

### 8.1 ç¬¬ä¸€é˜¶æ®µï¼šåŸºç¡€æ¶æ„ (2å‘¨)
- [x] é¡¹ç›®ç»“æ„æ­å»º
- [ ] æ•°æ®åº“è®¾è®¡
- [ ] åç«¯åŸºç¡€æ¡†æ¶
- [ ] å‰ç«¯åŸºç¡€æ¡†æ¶
- [ ] åŸºç¡€APIå®ç°

### 8.2 ç¬¬äºŒé˜¶æ®µï¼šæ ¸å¿ƒåŠŸèƒ½ (4å‘¨)
- [ ] é¾™è™æ¦œåŠŸèƒ½
- [ ] æ¸¸èµ„æ¦œåŠŸèƒ½
- [ ] å¤§ç›˜æŒ‡æ•°åŠŸèƒ½
- [ ] æ¦‚å¿µæ¿å—åŠŸèƒ½
- [ ] èµ„é‡‘æµåŠŸèƒ½
- [ ] æ¶¨åœæ± åŠŸèƒ½

### 8.3 ç¬¬ä¸‰é˜¶æ®µï¼šä¼˜åŒ–ä¸æµ‹è¯• (2å‘¨)
- [ ] æ€§èƒ½ä¼˜åŒ–
- [ ] å•å…ƒæµ‹è¯•
- [ ] é›†æˆæµ‹è¯•
- [ ] æ–‡æ¡£å®Œå–„

### 8.4 ç¬¬å››é˜¶æ®µï¼šéƒ¨ç½²ä¸Šçº¿ (1å‘¨)
- [ ] ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²
- [ ] ç›‘æ§é…ç½®
- [ ] å¤‡ä»½ç­–ç•¥
- [ ] ä¸Šçº¿éªŒè¯

## 9. æŠ€æœ¯éš¾ç‚¹ä¸è§£å†³æ–¹æ¡ˆ

### 9.1 æ•°æ®åŒæ­¥
**é—®é¢˜**: å¦‚ä½•ä¿è¯æ•°æ®çš„å®æ—¶æ€§å’Œå‡†ç¡®æ€§
**æ–¹æ¡ˆ**: 
- ä½¿ç”¨å®šæ—¶ä»»åŠ¡æ¯æ—¥åŒæ­¥
- å®ç°æ•°æ®æ ¡éªŒæœºåˆ¶
- æ”¯æŒæ‰‹åŠ¨è§¦å‘åŒæ­¥

### 9.2 æ€§èƒ½ä¼˜åŒ–
**é—®é¢˜**: å¤§é‡æ•°æ®æŸ¥è¯¢æ€§èƒ½é—®é¢˜
**æ–¹æ¡ˆ**:
- æ•°æ®åº“ç´¢å¼•ä¼˜åŒ–
- åˆ†é¡µæŸ¥è¯¢
- ç¼“å­˜çƒ­ç‚¹æ•°æ®
- å¼‚æ­¥å¤„ç†

### 9.3 æ•°æ®å¯è§†åŒ–
**é—®é¢˜**: å¤æ‚å›¾è¡¨å±•ç¤º
**æ–¹æ¡ˆ**:
- ä½¿ç”¨EChartså®ç°å›¾è¡¨
- ç»„ä»¶åŒ–è®¾è®¡
- å“åº”å¼å¸ƒå±€

## 10. å®‰å…¨è®¾è®¡

### 10.1 è®¤è¯æˆæƒ
- ä½¿ç”¨Supabase Authè¿›è¡Œç”¨æˆ·è®¤è¯
- JWT Tokenæœºåˆ¶
- è§’è‰²æƒé™æ§åˆ¶

### 10.2 æ•°æ®å®‰å…¨
- SQLæ³¨å…¥é˜²æŠ¤
- XSSæ”»å‡»é˜²æŠ¤
- CSRFé˜²æŠ¤
- æ•°æ®åŠ å¯†ä¼ è¾“

### 10.3 APIå®‰å…¨
- Rate Limiting
- è¯·æ±‚éªŒè¯
- é”™è¯¯ä¿¡æ¯è„±æ•

## 11. ç›‘æ§ä¸æ—¥å¿—

### 11.1 ç›‘æ§æŒ‡æ ‡
- APIå“åº”æ—¶é—´
- é”™è¯¯ç‡
- æ•°æ®åº“è¿æ¥æ•°
- ç³»ç»Ÿèµ„æºä½¿ç”¨

### 11.2 æ—¥å¿—ç®¡ç†
- åº”ç”¨æ—¥å¿—
- é”™è¯¯æ—¥å¿—
- è®¿é—®æ—¥å¿—
- æ—¥å¿—èšåˆåˆ†æ

